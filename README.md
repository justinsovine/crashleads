# CrashLeads
*Lead generation service for chiropractors and lawyers*

## Overview
CrashLeads scraped public records from the Ohio Department of Public Safety website in real-time. It downloaded PDF reports and converted them to XML using TET, then extracted data via positional coordinates. The extracted information was stored in a database and made accessible via a web portal or delivered through push/SMS/email notifications. This service generated around $1000 per month for several years and is now defunct.

## Architecture
The main workflow is orchestrated by **main.py**, while all core functionalities are housed in the **modules** directory.

```text
.
├── main.py          - Entry point that coordinates the overall workflow.
└── modules
    ├── download.py  - Handles downloading of PDF reports using urllib and verifies file types with python-magic.
    ├── notify.py    - Sends email notifications using the Mandrill API and interacts with a MySQL database via MySQLdb.
    ├── model.py     - Manages database operations including storing report, unit, and person data with MySQLdb.
    └── ocr.py       - Processes XML files generated by TET, extracting report data using xml.etree.ElementTree and regex.
```

### Implementation Details
- **main.py:**  
  - Orchestrates the overall process by tying together downloading, OCR processing, data extraction, database storage, and notifications.
  - Uses Selenium with PhantomJS for headless browser control.
  - Parses HTML table data using BeautifulSoup (from the `bs4` library).
  - Implements multiprocessing via Python's `multiprocessing.Pool` to parallelize OCR processing tasks.

- **modules/download.py:**  
  - Uses `urllib.request` to download PDF files.
  - Validates files using the `magic` library to ensure they are valid PDFs.
  - Supports different report types (e.g., digital and scanned) and performs file existence checks.

- **modules/notify.py:**  
  - Constructs and sends HTML email notifications via the Mandrill API.
  - Retrieves report and individual data from a MySQL database using MySQLdb.
  - Formats email content with direct links to digital and scanned reports.

- **modules/model.py:**  
  - Connects to a MySQL database using MySQLdb with a DictCursor for easier data handling.
  - Provides functions to store report data, unit data, and person data in the database.
  - Implements error handling with transaction rollbacks to maintain data integrity.

- **modules/ocr.py:**  
  - Processes XML output from TET using `xml.etree.ElementTree` to extract text.
  - Uses regular expressions to parse and clean numerical IDs and other structured information.
  - Adjusts XML content (e.g., stripping unwanted namespaces) to facilitate data extraction.

## Additional Resources
- **Sample Crash Report:** View `sample-report.pdf` for an example crash report.
- **Data Extract Sample:** Check `sample-extract.xml` to see the XML output from TET.
- **Website Code Sample:** The `ohio-dps-website.aspx` file shows the source website's front page code.
 
### Sample Video of the Program Running

[![Watch the video](https://img.youtube.com/vi/gEcPmh-3lDY/0.jpg)](https://www.youtube.com/watch?v=gEcPmh-3lDY)

[Watch the video on YouTube](https://www.youtube.com/watch?v=gEcPmh-3lDY)
